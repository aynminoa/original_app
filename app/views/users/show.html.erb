<h1>about me</h1>

<% if @user == current_user %>
<p>
  <%= link_to "アカウント編集", edit_user_registration_path %>
</p>
<% end %>

<% if @user.image.attached? %>
  <p>
    <strong>Image:</strong>
    <%= image_tag @user.image, size: '100x100' %>
  </p>
  <% else %>
  <p>**no picture**</p>
<% end %>
<h3>ユーザー名</h3>
<%= @user.name %>
<h3>メールアドレス</h3>
<%= @user.email %>
<h3>自己紹介</h3>
<%= @user.self_introduction %>

<table>
  <thead>
    <tr>
      <th>Title</th>
      <th>Visited on</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @user.albums.each do |album| %>
      <tr>
        <td><%= link_to album.title, album %></td>
        <td><%= album.visited_on.strftime("%Y年%m月") %></td>
        <% if album.user == current_user %>
          <td><%= link_to 'Edit', edit_album_path(album) %></td>
          <td><%= link_to 'Destroy', album_path(album, user_id: album.user_id), method: :delete, data: { confirm: 'Are you sure?' } %></td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>

<% if @user == current_user || @user == guest_user || @user == admin_guest_user %>
<p>アルバム新規作成</p>
<%= form_with(model: Album.new, url: {controller: 'albums', action: 'create' }, local: true) do |form| %>
<% if @album != nil && @album.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@album.errors.count, "error") %> prohibited this album from being saved:</h2>

      <ul>
        <% @album.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="field">
    <%= form.label :title %>
    <%= form.text_field :title %>
  </div>

  <div class="field">
    <%= form.label :visited_on %>
    <%= form.date_select :visited_on, {discard_day: true} %>
  </div>

  <%= form.hidden_field :user_id, value: @user.id %>

  <div class="actions">
    <%= form.submit %>
  </div>
<% end %>
<% end %>
